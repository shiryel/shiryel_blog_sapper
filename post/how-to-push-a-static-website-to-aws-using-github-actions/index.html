<!doctype html> <html lang=en> <head> <meta charset=utf-8> <meta content="width=device-width,initial-scale=1" name=viewport> <meta content=#333333 name=theme-color> <meta content=Shiryel name=author> <base href=/ > <link href=global.css rel=stylesheet> <link href=manifest.json rel=manifest crossorigin=use-credentials> <link href=favicon.png rel=icon type=image/png> <link href=client/client-6bd6c6fc.css rel=stylesheet><link href=client/card_list-7cb58e9f.css rel=stylesheet><link href=client/_layout-cc40cc95.css rel=stylesheet> <title>How to push a static website to AWS using github actions</title><link href=prism.css rel=stylesheet><meta content=article property=og:type><meta content=https://blog.shiryel.com/posts/how-to-push-a-static-website-to-aws-using-github-actions property=og:url><meta content=https://blog.shiryel.com/images/logo-512.png property=og:image><meta content="A blog post as a reminder on how to work with static websites on AWS using github actions" name=description><meta content="aws, github actions, static website" name=keywords><meta content="Push a static website to AWS using github actions" property=og:title><meta content="A reminder on how to push a static website to AWS using github actions with the minimum of enfort" property=og:description> <link href=/client/client.dcf6c939.js rel=modulepreload as=script crossorigin=use-credentials><link href=/client/client-6bd6c6fc.css rel=preload as=style><link href=/client/how-to-push-a-static-website-to-aws-using-github-actions.5502eba0.js rel=modulepreload as=script crossorigin=use-credentials><link href=/client/inject_styles.5607aec6.js rel=modulepreload as=script crossorigin=use-credentials></head> <body> <div id=sapper> <div class="svelte-1naqmte sitemap"><a href=sitemap.xml>sitemap</a></div> <div class="svelte-s5zwdt left"><a href=https://www.shiryel.com/ class=svelte-s5zwdt rel=noopener target=_blank>Shiryel's Den </a></div> <div class="svelte-s5zwdt right"><a href="https://twitter.com/shiryel_?ref_src=twsrc%5Etfw" class="svelte-s5zwdt twitter-follow-button" rel=noopener data-size=large data-show-count=false>Follow @shiryel_ </a></div> <div class="svelte-s5zwdt social"><a href="https://twitter.com/shiryel_?ref_src=twsrc%5Etfw" class="svelte-s5zwdt twitter-timeline" rel=noopener data-chrome="noheader nofooter noborders transparent" data-dnt=true data-height=90vh data-tweet-limit=2 data-width=300>Tweets by shiryel_ </a> <script src=https://platform.twitter.com/widgets.js></script></div> <footer><a href=https://github.com/shiryel/shiryel_blog class=svelte-1spf4py rel=noopener target=_blank>See on Github</a></footer> <div class="svelte-1naqmte background-1"></div> <main class=svelte-1naqmte><aside class=svelte-1naqmte></aside> <div class="svelte-1naqmte background-2"> <div class="svelte-tsbvfd div"><aside class=svelte-tsbvfd><a href=/ class=svelte-tsbvfd>Home</a></aside> <article class="svelte-tsbvfd content" itemscope itemtype=http://schema.org/TechArticle> <h1 itemprop=name>How to push a static website to AWS using github actions </h1> <p>This is my personal default template for npm projects:</p> <pre class=language-yml><code class=language-yml><span class="token atrule key">name</span><span class="token punctuation">:</span> Push to AWS <span class="token punctuation">[</span>CD<span class="token punctuation">]</span>

<span class="token atrule key">on</span><span class="token punctuation">:</span>
  <span class="token atrule key">push</span><span class="token punctuation">:</span>
    <span class="token atrule key">branches</span><span class="token punctuation">:</span> <span class="token punctuation">[</span> master <span class="token punctuation">]</span>

<span class="token atrule key">jobs</span><span class="token punctuation">:</span>
  <span class="token atrule key">build</span><span class="token punctuation">:</span>
    <span class="token atrule key">runs-on</span><span class="token punctuation">:</span> ubuntu<span class="token punctuation">-</span>latest

    <span class="token atrule key">steps</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token atrule key">uses</span><span class="token punctuation">:</span> actions/checkout@v2
    <span class="token punctuation">-</span> <span class="token atrule key">uses</span><span class="token punctuation">:</span> actions/setup<span class="token punctuation">-</span>node@v1
      <span class="token atrule key">with</span><span class="token punctuation">:</span>
        <span class="token atrule key">node-version</span><span class="token punctuation">:</span> 14.x 
    
    <span class="token punctuation">-</span> <span class="token atrule key">name</span><span class="token punctuation">:</span> NPM <span class="token punctuation">-</span> install
      <span class="token atrule key">run</span><span class="token punctuation">:</span> npm i
    
    <span class="token punctuation">-</span> <span class="token atrule key">name</span><span class="token punctuation">:</span> NPM <span class="token punctuation">-</span> export
      <span class="token atrule key">run</span><span class="token punctuation">:</span> npm run export

    <span class="token punctuation">-</span> <span class="token atrule key">name</span><span class="token punctuation">:</span> AWS <span class="token punctuation">-</span> Set PEM
      <span class="token atrule key">run</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
        echo "${{ secrets.AWS_PEM }}" > temp.pem
        chmod 400 temp.pem</span>

    <span class="token punctuation">-</span> <span class="token atrule key">name</span><span class="token punctuation">:</span> AWS <span class="token punctuation">-</span> Exclude last files if exists
      <span class="token atrule key">run</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
           ssh -q -o "StrictHostKeyChecking no" -i temp.pem ${{ secrets.AWS_SSH }} \
             rm -r /www/shiryel_blog/*</span>

    <span class="token punctuation">-</span> <span class="token atrule key">name</span><span class="token punctuation">:</span> AWS <span class="token punctuation">-</span> Send new files to server
      <span class="token atrule key">if</span><span class="token punctuation">:</span> success() <span class="token punctuation">|</span><span class="token punctuation">|</span> failure()
      <span class="token atrule key">run</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
        scp -o "StrictHostKeyChecking no" -i temp.pem  -r \
          __sapper__/export/* ${{ secrets.AWS_SSH }}:/www/shiryel_blog/</span>

    <span class="token punctuation">-</span> <span class="token atrule key">name</span><span class="token punctuation">:</span> AWS <span class="token punctuation">-</span> Clear PEM
      <span class="token atrule key">if</span><span class="token punctuation">:</span> always()
      <span class="token atrule key">run</span><span class="token punctuation">:</span> rm <span class="token punctuation">-</span>f temp.pem</code></pre> <p>So lets see what hapens here</p> <h2>First, the scope</h2> <pre class=language-yml><code class=language-yml><span class="token atrule key">on</span><span class="token punctuation">:</span>
  <span class="token atrule key">push</span><span class="token punctuation">:</span>
    <span class="token atrule key">branches</span><span class="token punctuation">:</span> <span class="token punctuation">[</span> master <span class="token punctuation">]</span></code></pre> <p>This says to run this script when a push is made on the master branch</p> <h2>Then the machine pre-config</h2> <pre class=language-yml><code class=language-yml><span class="token atrule key">jobs</span><span class="token punctuation">:</span>
  <span class="token atrule key">build</span><span class="token punctuation">:</span>
    <span class="token atrule key">runs-on</span><span class="token punctuation">:</span> ubuntu<span class="token punctuation">-</span>latest

    <span class="token atrule key">steps</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token atrule key">uses</span><span class="token punctuation">:</span> actions/checkout@v2
    <span class="token punctuation">-</span> <span class="token atrule key">uses</span><span class="token punctuation">:</span> actions/setup<span class="token punctuation">-</span>node@v1
      <span class="token atrule key">with</span><span class="token punctuation">:</span>
        <span class="token atrule key">node-version</span><span class="token punctuation">:</span> 14.x </code></pre> <p>This says to run a countainer on ubuntu (latest version), get the code with checkout, and setup a node version 14</p> <h2>NPM need to make the NPM things</h2> <pre class=language-yml><code class=language-yml>    <span class="token punctuation">-</span> <span class="token atrule key">name</span><span class="token punctuation">:</span> NPM <span class="token punctuation">-</span> install
      <span class="token atrule key">run</span><span class="token punctuation">:</span> npm i
    
    <span class="token punctuation">-</span> <span class="token atrule key">name</span><span class="token punctuation">:</span> NPM <span class="token punctuation">-</span> export
      <span class="token atrule key">run</span><span class="token punctuation">:</span> npm run export</code></pre> <p>Yes</p> <h2>AWS time, first the PEM</h2> <p>With the PEM on hands, you add it on your github secrets (keep in mind that this aproach is for very small projects, you may want another aproach) And create a PEM file on your machine</p> <pre class=language-yml><code class=language-yml>    <span class="token punctuation">-</span> <span class="token atrule key">name</span><span class="token punctuation">:</span> AWS <span class="token punctuation">-</span> Set PEM
      <span class="token atrule key">run</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
        echo "${{ secrets.AWS_PEM }}" > temp.pem
        chmod 400 temp.pem</span></code></pre> <h2>Then I delete the current static files on AWS if it exists</h2> <p>In my case I like to put the SSH connection (that who you get for connecting on the AWS with your PEM) as a secret (the AWS_SSH)</p> <pre class=language-yml><code class=language-yml>    <span class="token punctuation">-</span> <span class="token atrule key">name</span><span class="token punctuation">:</span> AWS <span class="token punctuation">-</span> Exclude last files if exists
      <span class="token atrule key">run</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
           ssh -q -o "StrictHostKeyChecking no" -i temp.pem ${{ secrets.AWS_SSH }} \
             rm -r /www/shiryel_blog/*</span></code></pre> <p>And yes, make the path modifications for your own files</p> <h2>Finally I send the files to the server</h2> <pre class=language-yml><code class=language-yml>    <span class="token punctuation">-</span> <span class="token atrule key">name</span><span class="token punctuation">:</span> AWS <span class="token punctuation">-</span> Send new files to server
      <span class="token atrule key">if</span><span class="token punctuation">:</span> success() <span class="token punctuation">|</span><span class="token punctuation">|</span> failure()
      <span class="token atrule key">run</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
        scp -o "StrictHostKeyChecking no" -i temp.pem  -r \
          __sapper__/export/* ${{ secrets.AWS_SSH }}:/www/shiryel_blog/</span></code></pre> <p>Modify the <code>__sapper__/export</code> and <code>/www/shiryel_blog</code> for your needs :)</p> <h2>And even if it fails… remove the PEM</h2> <pre class=language-yml><code class=language-yml>    <span class="token punctuation">-</span> <span class="token atrule key">name</span><span class="token punctuation">:</span> AWS <span class="token punctuation">-</span> Clear PEM
      <span class="token atrule key">if</span><span class="token punctuation">:</span> always()
      <span class="token atrule key">run</span><span class="token punctuation">:</span> rm <span class="token punctuation">-</span>f temp.pem</code></pre> <p>That is all folks, have a grat day :)</article> <div class="svelte-tsbvfd twitter"><a href="https://twitter.com/intent/tweet?text=Take%20a%20look%20on%20this%20" class="svelte-tsbvfd twitter-share-button" rel=noopener data-size=large data-hashtags=shiryel_blog>Tweet </a> <script src=https://platform.twitter.com/widgets.js></script></div> <aside class=svelte-tsbvfd><a href=/ class=svelte-tsbvfd>Home</a></aside> <aside class=svelte-tsbvfd><section class=svelte-wo6t4x><div class="svelte-wo6t4x name"><h2 class=svelte-wo6t4x>More</h2></div> <div class="svelte-wo6t4x cards" itemscope itemtype=http://schema.org/TechArticle><a href=/post/testing-phoenix-channels-on-browser-console class=svelte-1vtidd itemprop=url><div><h3 class=svelte-1vtidd itemprop=name>Testing Phoenix Channels on Browser console</h3></div> <p class=svelte-1vtidd itemprop=description></p> <aside class=svelte-1vtidd><span class=svelte-1vtidd itemprop=keywords>phoenix framework</span><span class=svelte-1vtidd itemprop=keywords>elixir</span><span class=svelte-1vtidd itemprop=keywords>phoenix channels</span><span class=svelte-1vtidd itemprop=keywords>manual test</span></aside></a><a href=/post/how-to-use-only-one-certificate-with-certbot-and-nginx class=svelte-1vtidd itemprop=url><div><h3 class=svelte-1vtidd itemprop=name>How to use only one certificate with certbot and nginx</h3></div> <p class=svelte-1vtidd itemprop=description></p> <aside class=svelte-1vtidd><span class=svelte-1vtidd itemprop=keywords>nginx</span><span class=svelte-1vtidd itemprop=keywords>certbot</span><span class=svelte-1vtidd itemprop=keywords>aws</span><span class=svelte-1vtidd itemprop=keywords>continuous integration</span></aside></a><a href=/post/how-to-push-a-static-website-to-aws-using-github-actions class=svelte-1vtidd itemprop=url><div><h3 class=svelte-1vtidd itemprop=name>How to push a static website to AWS using github actions</h3></div> <p class=svelte-1vtidd itemprop=description></p> <aside class=svelte-1vtidd><span class=svelte-1vtidd itemprop=keywords>github actions</span><span class=svelte-1vtidd itemprop=keywords>aws</span><span class=svelte-1vtidd itemprop=keywords>continuous integration</span></aside></a><a href=/post/how-to-add-svelte-on-elixir-phoenix-framework class=svelte-1vtidd itemprop=url><div><h3 class=svelte-1vtidd itemprop=name>How to add Svelte on Elixir Phoenix Framework</h3></div> <p class=svelte-1vtidd itemprop=description></p> <aside class=svelte-1vtidd><span class=svelte-1vtidd itemprop=keywords>elixir</span><span class=svelte-1vtidd itemprop=keywords>svelte</span></aside></a></div></section></aside></div></div> <aside class=svelte-1naqmte></aside></main></div> <script>__SAPPER__={baseUrl:"",preloaded:[void 0,(function(a,b,c,d){return {posts:[{title:"Testing Phoenix Channels on Browser console",slug:"testing-phoenix-channels-on-browser-console",description:a,tags:["phoenix framework",b,"phoenix channels","manual test"],date:"2020-08-02"},{title:"How to use only one certificate with certbot and nginx",slug:"how-to-use-only-one-certificate-with-certbot-and-nginx",description:a,tags:["nginx","certbot",c,d],date:"2020-07-23"},{title:"How to push a static website to AWS using github actions",slug:"how-to-push-a-static-website-to-aws-using-github-actions",description:a,tags:["github actions",c,d],date:"2020-07-20"},{title:"How to add Svelte on Elixir Phoenix Framework",slug:"how-to-add-svelte-on-elixir-phoenix-framework",description:a,tags:[b,"svelte"],date:"2020-07-17"}]}}("","elixir","aws","continuous integration")),{}]};if('serviceWorker' in navigator)navigator.serviceWorker.register('/service-worker.js');(function(){try{eval("async function x(){}");var main="/client/client.dcf6c939.js"}catch(e){main="/client/legacy/client.5b27cb88.js"};var s=document.createElement("script");try{new Function("if(0)import('')")();s.src=main;s.type="module";s.crossOrigin="use-credentials";}catch(e){s.src="/client/shimport@2.0.4.js";s.setAttribute("data-main",main);}document.head.appendChild(s);}());</script> 