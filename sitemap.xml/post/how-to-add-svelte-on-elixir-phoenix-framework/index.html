<!doctype html> <html lang=en> <head> <meta charset=utf-8> <meta content="width=device-width,initial-scale=1" name=viewport> <meta content=#333333 name=theme-color> <meta content=Shiryel name=author> <base href=/ > <link href=global.css rel=stylesheet> <link href=manifest.json rel=manifest crossorigin=use-credentials> <link href=favicon.png rel=icon type=image/png> <link href=client/main.1926282405.css rel=stylesheet> <noscript id=sapper-head-start></noscript><title>How to add svelte on Elixir Phoenix Framework</title><script src=https://platform.twitter.com/widgets.js></script><link href=prism.css rel=stylesheet><meta content="A blog post as a reminder on how to work with svelte on Elixir" name=description><meta content="elixir, svelte" name=keywords><noscript id=sapper-head-end></noscript> </head> <body> <div id=sapper> <div class=svelte-fg83id><div style=z-index:10;justify-self:end id=__saos-0.4820930366921099__><div style="animation:from-top 5s cubic-bezier(.35,.5,.65,.95) both"><img alt="a fennec saying bounjour, part 1" class="svelte-fg83id left" src=bounjour-1.png></div></div> <div style=z-index:10 id=__saos-0.8542385556635856__><div style="animation:from-top 5s cubic-bezier(.35,.5,.65,.95) both"><img alt="a fennec saying bounjour, part 2" class=svelte-fg83id src=bounjour-2.png></div></div></div> <div class="svelte-1ey4nwp left"><a href=https://www.shiryel.com/ class=svelte-1ey4nwp target=_blank>Shiryel's Den</a></div> <div class="svelte-1ey4nwp right"><a href="https://twitter.com/shiryel_?ref_src=twsrc%5Etfw" class="svelte-1ey4nwp twitter-follow-button" data-size=large data-show-count=false>Follow @shiryel_ </a></div> <div class="svelte-1ey4nwp social"><a href="https://twitter.com/shiryel_?ref_src=twsrc%5Etfw" class="svelte-1ey4nwp twitter-timeline" data-chrome="noheader nofooter noborders transparent" data-dnt=true data-height=90vh data-width=300>Tweets by shiryel_ </a></div> <footer><a href=https://github.com/shiryel/shiryel_blog class=svelte-1spf4py target=_blank>See on Github</a></footer> <img alt="A mountain background" class="svelte-14zormg background-1" src=background.jpg> <main class=svelte-14zormg><aside class=svelte-14zormg></aside> <div class="svelte-14zormg background-2"> <div class="svelte-17vs08x div"><aside class=svelte-17vs08x><a href=/ class=svelte-17vs08x>Home</a></aside> <article class="svelte-17vs08x content"> <h1>How to add svelte on Elixir Phoenix Framework</h1> <h2>Adding the Svelte and Svelte-Loader</h2> <p>To do that, run this on the root dir of your phoenix project:</p> <pre class=language-bash>
<code class=language-bash><span class="token class-name builtin">cd</span> assets <span class="token operator">&&</span> <span class="token function">npm</span> <span class="token function">install</span> svelte svelte-loader --save</code></pre> <h2>Configuring the webpack</h2> <p>Based on: <a href=https://github.com/sveltejs/template-webpack rel=nofollow>https://github.com/sveltejs/template-webpack</a></p> <p>First add this on asserts/webpack.config.js:</p> <pre class=language-js>
<code class=language-js>resolve<span class="token operator">:</span> <span class="token punctuation">{</span>
	alias<span class="token operator">:</span> <span class="token punctuation">{</span>
		svelte<span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'node_modules'</span><span class="token punctuation">,</span> <span class="token string">'svelte'</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
	extensions<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'.mjs'</span><span class="token punctuation">,</span> <span class="token string">'.js'</span><span class="token punctuation">,</span> <span class="token string">'.svelte'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
	mainFields<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'svelte'</span><span class="token punctuation">,</span> <span class="token string">'browser'</span><span class="token punctuation">,</span> <span class="token string">'module'</span><span class="token punctuation">,</span> <span class="token string">'main'</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span></code></pre> <p>Then add:</p> <pre class=language-javascript>
<code class=language-javascript><span class="token punctuation">{</span>
	test<span class="token operator">:</span> <span class="token regex">/.svelte$/</span><span class="token punctuation">,</span>
	use<span class="token operator">:</span> <span class="token punctuation">{</span>
		loader<span class="token operator">:</span> <span class="token string">'svelte-loader'</span><span class="token punctuation">,</span>
		options<span class="token operator">:</span> <span class="token punctuation">{</span>
			emitCss<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
			hotReload<span class="token operator">:</span> <span class="token boolean">true</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre> <p>For the config explanations see: <a href=https://github.com/sveltejs/svelte-loader rel=nofollow>https://github.com/sveltejs/svelte-loader</a></p> <h2>Adding the function on Phoenix</h2> <p>On your APP_web.ex in the function <code>view_helpers</code> add the function:</p> <pre class=language-elixir>
<code class=language-elixir><span class="token attribute variable">@doc</span> <span class="token string">"""
Will add a component from the asserts/js/svelte, the component must have the same `file_name`
"""</span>
<span class="token attribute variable">@spec</span> svelte<span class="token punctuation">(</span>bitstring<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> map<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">::</span> Phoenix<span class="token punctuation">.</span>HTML<span class="token punctuation">.</span>safe<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> svelte<span class="token punctuation">(</span>file_name<span class="token punctuation">,</span> props <span class="token operator">\</span> <span class="token punctuation">%</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token keyword">do</span>
  <span class="token punctuation">{</span><span class="token atom symbol">:ok</span><span class="token punctuation">,</span> props<span class="token punctuation">}</span> <span class="token operator">=</span> Jason<span class="token punctuation">.</span>encode<span class="token punctuation">(</span>props<span class="token punctuation">)</span>

  tag <span class="token operator">=</span>
    Phoenix<span class="token punctuation">.</span>HTML<span class="token punctuation">.</span>Tag<span class="token punctuation">.</span>tag<span class="token punctuation">(</span><span class="token atom symbol">:div</span><span class="token punctuation">,</span>
      <span class="token attr-name">data:</span> <span class="token punctuation">[</span><span class="token attr-name">props:</span> props<span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token attr-name">class:</span> <span class="token string">"__svelte__-<span class="token interpolation"><span class="token punctuation delimiter">#{</span>file_name<span class="token punctuation delimiter">}</span></span>"</span>
    <span class="token punctuation">)</span>
    <span class="token operator">|></span> Phoenix<span class="token punctuation">.</span>HTML<span class="token punctuation">.</span>safe_to_string<span class="token punctuation">(</span><span class="token punctuation">)</span>

  Phoenix<span class="token punctuation">.</span>HTML<span class="token punctuation">.</span>raw<span class="token punctuation">(</span>tag <span class="token operator">&lt;></span> <span class="token string">"&lt;/div>"</span><span class="token punctuation">)</span>
<span class="token keyword">end</span></code></pre> <p><code>Note: You can define this function in another file and import if you want a more clean solution</code></p> <h2>Mounting the svelte component</h2> <p>Finally we need to get the svelte file and mount on the element defined by the function above, for this we create a file <code>svelte.js</code> on assets/js/</p> <pre class=language-javascript>
<code class=language-javascript><span class="token comment">// This code will look in the assets/js/svelte/ and in the sub-directorys for</span>
<span class="token comment">// .svelte files, the result of this files will be mounted on the element</span>
<span class="token comment">// "svelte-file_name" who have props from the phoenix render(name, props)</span>

<span class="token comment">// directory, useSubdirectories, regex</span>
<span class="token keyword">const</span> context <span class="token operator">=</span> require<span class="token punctuation">.</span><span class="token function">context</span><span class="token punctuation">(</span><span class="token string">"./svelte"</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token regex">/.svelte$/</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

window<span class="token punctuation">.</span><span class="token function function-variable">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  context<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">file_path</span> <span class="token operator">=></span> <span class="token punctuation">{</span>
    <span class="token comment">// name that will be requeride by render(name, props)</span>
    <span class="token keyword">const</span> file_name <span class="token operator">=</span> file_path<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/./|.svelte$/g</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// COMPONENT</span>
    <span class="token keyword">const</span> component_name <span class="token operator">=</span> <span class="token template-string"><span class="token string template-punctuation">`</span><span class="token string">svelte-</span><span class="token interpolation"><span class="token punctuation interpolation-punctuation">${</span>file_name<span class="token punctuation interpolation-punctuation">}</span></span><span class="token string template-punctuation">`</span></span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> component_container <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span>component_name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>component_container<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// PROPS</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> props <span class="token punctuation">}</span> <span class="token operator">=</span> component_container<span class="token punctuation">.</span>dataset<span class="token punctuation">;</span>
    <span class="token keyword">let</span> my_props <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>props<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      my_props <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>props<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// MOUNT ON</span>
    <span class="token keyword">const</span> App <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string template-punctuation">`</span><span class="token string">./svelte/</span><span class="token interpolation"><span class="token punctuation interpolation-punctuation">${</span>file_name<span class="token punctuation interpolation-punctuation">}</span></span><span class="token string template-punctuation">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">new</span> <span class="token class-name">App<span class="token punctuation">.</span>default</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      target<span class="token operator">:</span> component_container<span class="token punctuation">,</span>
      props<span class="token operator">:</span> my_props
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre> <h2>Testing</h2> <p>Just create a component and add a</p> <pre class=language-elixir>
<code class=language-elixir>&lt;<span class="token punctuation">%</span><span class="token operator">=</span> svelte <span class="token string">"YOUR_COMPONENT_FILE_NAME"</span><span class="token punctuation">,</span> <span class="token punctuation">%</span><span class="token punctuation">{</span><span class="token attr-name">some_var:</span> <span class="token string">"some value"</span><span class="token punctuation">}</span> <span class="token punctuation">%</span><span class="token operator">></span></code></pre> <p>on a template :)</p> <p>Note 1: Yes, the YOUR_COMPONENT_FILE_NAME is the name of your file, please change it ;)</p> <p>Note 2: The props will be used on your <code>export</code> variables on the svelte component</article> <div class="svelte-17vs08x twitter"><a href="https://twitter.com/intent/tweet?text=Take%20a%20look%20on%20this%20" class="svelte-17vs08x twitter-share-button" data-size=large data-hashtags=shiryel_blog>Tweet </a></div> <aside class=svelte-17vs08x><a href=/ class=svelte-17vs08x>Home</a></aside> <aside class=svelte-17vs08x><section class=svelte-1r4o3mm><div class="svelte-1r4o3mm name"><h2 class=svelte-1r4o3mm>More</h2></div> <div class="svelte-1r4o3mm cards"><div style="" id=__saos-0.8502175176447073__><div style="animation:fade-in .3s cubic-bezier(.35,.5,.65,.95) both"><a href=/post/how-to-use-only-one-certificate-with-certbot-and-nginx class=svelte-zrtu8><div><h3 class=svelte-zrtu8>How to use only one certificate with certbot and nginx</h3></div> <p class=svelte-zrtu8></p> <aside class=svelte-zrtu8><span class=svelte-zrtu8>nginx</span><span class=svelte-zrtu8>certbot</span><span class=svelte-zrtu8>aws</span><span class=svelte-zrtu8>continuous integration</span></aside></a></div></div><div style="" id=__saos-0.73797425622498__><div style="animation:fade-in .3s cubic-bezier(.35,.5,.65,.95) both"><a href=/post/how-to-push-a-static-website-to-aws-using-github-actions class=svelte-zrtu8><div><h3 class=svelte-zrtu8>How to push a static website to AWS using github actions</h3></div> <p class=svelte-zrtu8></p> <aside class=svelte-zrtu8><span class=svelte-zrtu8>github actions</span><span class=svelte-zrtu8>aws</span><span class=svelte-zrtu8>continuous integration</span></aside></a></div></div><div style="" id=__saos-0.7341494405359208__><div style="animation:fade-in .3s cubic-bezier(.35,.5,.65,.95) both"><a href=/post/how-to-add-svelte-on-elixir-phoenix-framework class=svelte-zrtu8><div><h3 class=svelte-zrtu8>How to add Svelte on Elixir Phoenix Framework</h3></div> <p class=svelte-zrtu8></p> <aside class=svelte-zrtu8><span class=svelte-zrtu8>elixir</span><span class=svelte-zrtu8>svelte</span></aside></a></div></div></div></section></aside></div></div> <aside class=svelte-14zormg></aside></main></div> <script>__SAPPER__={baseUrl:"",preloaded:[void 0,(function(a,b,c){return {posts:[{title:"How to use only one certificate with certbot and nginx",slug:"how-to-use-only-one-certificate-with-certbot-and-nginx",description:a,tags:["nginx","certbot",b,c],date:"2020-07-23"},{title:"How to push a static website to AWS using github actions",slug:"how-to-push-a-static-website-to-aws-using-github-actions",description:a,tags:["github actions",b,c],date:"2020-07-20"},{title:"How to add Svelte on Elixir Phoenix Framework",slug:"how-to-add-svelte-on-elixir-phoenix-framework",description:a,tags:["elixir","svelte"],date:"2020-07-17"}]}}("","aws","continuous integration")),{}]};if('serviceWorker' in navigator)navigator.serviceWorker.register('/service-worker.js');(function(){try{eval("async function x(){}");var main="/client/client.1565d37b.js"}catch(e){main="/client/legacy/client.be9c3b83.js"};var s=document.createElement("script");try{new Function("if(0)import('')")();s.src=main;s.type="module";s.crossOrigin="use-credentials";}catch(e){s.src="/client/shimport@1.0.1.js";s.setAttribute("data-main",main);}document.head.appendChild(s);}());</script> 